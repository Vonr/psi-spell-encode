import test from 'ava'

import { spellFromSnbt, spellToSnbt, encodeSpell, decodeSpell } from '../index.js'

const spellSnbt = '{modsRequired:[{modName:"psi",modVersion:"2.0.0"}],spellList:[{data:{key:"psi:connector",params:{_target:4}},x:1,y:2},{data:{key:"psi:operator_vector_sum",params:{_vector1:1,_vector2:4,_vector3:0}},x:1,y:3},{data:{key:"psi:connector",params:{_target:1}},x:1,y:4},{data:{comment:"≥0 | Length of Closest to Line | ¡Changing may have unintended consequences!",constantValue:"32",key:"psi:constant_number"},x:2,y:1},{data:{key:"psi:operator_vector_multiply",params:{_number2:1,_vector1:4}},x:2,y:2},{data:{key:"psi:operator_entity_position",params:{_target:4}},x:2,y:3},{data:{key:"psi:operator_closest_to_line",params:{_list:2,_ray_end:3,_ray_start:1}},x:2,y:4},{data:{key:"psi:selector_nearby_enemies",params:{_position:0,_radius:0}},x:2,y:5},{data:{key:"psi:trick_die",params:{_target:4}},x:3,y:1},{data:{key:"psi:operator_entity_look",params:{_target:2}},x:3,y:2},{data:{key:"psi:selector_caster"},x:3,y:3},{data:{key:"psi:connector",params:{_target:3}},x:3,y:4},{data:{key:"psi:operator_cos",params:{_target:4}},x:3,y:5},{data:{key:"psi:trick_die",params:{_target:1}},x:3,y:6},{data:{key:"psi:operator_extract_sign",params:{_target:2}},x:4,y:1},{data:{key:"psi:operator_entity_health",params:{_target:2}},x:4,y:2},{data:{key:"psi:operator_focused_entity",params:{_target:3}},x:4,y:3},{data:{key:"psi:error_catch",params:{_fallback:3,_target:1}},x:4,y:4},{data:{key:"psi:selector_block_presence",params:{_position:4}},x:4,y:5},{data:{key:"psi:trick_torrent",params:{_position:4}},x:4,y:6},{data:{comment:"(int) ≥1 | Conjure Duration | ¡Changing may have unintended consequences!",constantValue:"1",key:"psi:constant_number"},x:4,y:7},{data:{comment:"¡AVOID USE IN NETHER! | Conjures a non-destructive explosion on focused entity or a hostile mob.",key:"psi:error_suppressor"},x:5,y:1},{data:{key:"psi:selector_block_presence",params:{_position:2}},x:5,y:2},{data:{key:"psi:operator_entity_position",params:{_target:3}},x:5,y:3},{data:{key:"psi:connector",params:{_target:1}},x:5,y:4},{data:{key:"psi:operator_vector_sum",params:{_vector1:1,_vector2:4,_vector3:0}},x:5,y:5},{data:{key:"psi:connector",params:{_target:1}},x:5,y:6},{data:{key:"psi:trick_conjure_block",params:{_position:1,_time:3}},x:5,y:7},{data:{key:"psi:operator_extract_sign",params:{_target:3}},x:6,y:2},{data:{key:"psi:operator_sum",params:{_number1:2,_number2:1,_number3:0}},x:6,y:3},{data:{key:"psi:operator_vector_extract_y",params:{_target:3}},x:6,y:4},{data:{key:"psi:operator_vector_construct",params:{_x:0,_y:4,_z:0}},x:6,y:5},{data:{key:"psi:trick_explode",params:{_position:3,_power:2}},x:6,y:6},{data:{comment:">0 | Explosion Power | Damage scales with this value.",constantValue:"1",key:"psi:constant_number"},x:6,y:7},{data:{key:"psi:operator_floor",params:{_number:3}},x:7,y:3},{data:{key:"psi:operator_subtract",params:{_number1:1,_number2:3,_number3:0}},x:7,y:4},{data:{key:"psi:operator_max",params:{_number1:2,_number2:1,_number3:0}},x:7,y:5},{data:{comment:"=0 | ¡Critical Math Component! | ¡Changing may break the spell!",constantValue:"0",key:"psi:constant_number"},x:7,y:6}],spellName:"Fog Removal MkIV§6 τ",uuidLeast:-5268298990678557131L,uuidMost:521204765148663540L,validSpell:1b}'

test('Encode and decode deeply equal', (t) => {
  let spell = spellFromSnbt(spellSnbt)
  t.deepEqual(decodeSpell(encodeSpell(spell)), spell)
})
